<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GuestPickup</title>
<style>
* {margin:0;padding:0;box-sizing:border-box}
body {font-family:system-ui, sans-serif;background:#f5f5f7;color:#1d1d1f}
.container {max-width:1200px;margin:0 auto;padding:20px}
.header{text-align:center;margin-bottom:40px}
.header h1{font-size:2.5rem;margin-bottom:8px}
.tabs{display:flex;border-bottom:1px solid #ddd;margin-bottom:20px;overflow-x:auto}
.tab{padding:12px 16px;cursor:pointer;border:none;background:none;font-size:14px;color:#666;border-bottom:2px solid transparent;white-space:nowrap}
.tab.active{color:#007aff;border-bottom-color:#007aff}
.content{display:none}
.content.active{display:block}
.card{background:white;border-radius:12px;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,0.1);margin-bottom:20px}
.btn{background:#007aff;color:white;border:none;border-radius:8px;padding:10px 20px;font-size:15px;cursor:pointer}
.btn:hover{background:#0056b3}
.form-group{margin-bottom:16px}
.form-label{display:block;margin-bottom:8px;font-weight:600}
.form-input{width:100%;padding:10px;border:1px solid #ccc;border-radius:8px}
.empty{text-align:center;padding:40px;color:#777}
</style>
</head>
<body>
<div class="container">
<div class="header"><h1>üöó GuestPickup</h1><p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å—Ç—Ä–µ—á–∞–º–∏ –≥–æ—Å—Ç–µ–π</p></div>

<div id="login-screen" class="card">
  <h2>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
  <p>–í—ã–±–µ—Ä–∏—Ç–µ, –∫—Ç–æ –≤—ã:</p>
  <div style="display:flex;gap:10px;margin-top:15px;">
    <button class="btn" onclick="loginAs('guest')">–ì–æ—Å—Ç—å</button>
    <button class="btn" onclick="loginAs('driver')">–í–æ–¥–∏—Ç–µ–ª—å</button>
    <button class="btn" onclick="loginAs('admin')">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</button>
  </div>
</div>

<div id="guest-login" class="card" style="display:none;">
  <h2>–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ—ë –∏–º—è</h2>
  <input type="text" id="guestNameInput" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω">
  <button class="btn" style="margin-top:10px;" onclick="enterGuest()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
</div>

<div id="main-app" style="display:none;">
  <div class="tabs" id="tabs">
    <button class="tab active" onclick="showTab('queue')">üìã –û—á–µ—Ä–µ–¥—å</button>
    <button class="tab" onclick="showTab('drivers')">üöó –í–æ–¥–∏—Ç–µ–ª–∏</button>
    <button class="tab" onclick="showTab('orders')">üì¶ –ó–∞–∫–∞–∑—ã</button>
    <button class="tab" onclick="showTab('add')">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
  </div>

  <div id="queue" class="content active"><div class="card"><h2>üìã –û—á–µ—Ä–µ–¥—å</h2><div id="queue-list" class="empty">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div></div></div>
  <div id="drivers" class="content"><div class="card"><h2>üöó –í–æ–¥–∏—Ç–µ–ª–∏</h2><div id="drivers-list" class="empty">–ù–µ—Ç –≤–æ–¥–∏—Ç–µ–ª–µ–π</div></div></div>
  <div id="orders" class="content"><div class="card"><h2>üì¶ –ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2><div id="orders-list" class="empty">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div></div></div>
  <div id="add" class="content"><div class="card">
      <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –≥–æ—Å—Ç—è</h2>
      <div class="form-group"><label class="form-label">–§–ò–û –≥–æ—Å—Ç—è</label><input type="text" id="guestName" class="form-input"></div>
      <div class="form-group"><label class="form-label">–ö—Ç–æ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç</label><input type="text" id="controlPerson" class="form-input"></div>
      <div class="form-group"><label class="form-label">–û—Ç–µ–ª—å</label><input type="text" id="hotelName" class="form-input"></div>
      <div class="form-group"><label class="form-label">–î–∞—Ç–∞ –≤—Å—Ç—Ä–µ—á–∏</label><input type="datetime-local" id="pickupDate" class="form-input"></div>
      <div class="form-group"><label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label><textarea id="pickupComment" class="form-input"></textarea></div>
      <button class="btn" onclick="addGuest()">–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</button>
  </div></div>
</div>
</div>

<script>
let role=null, currentGuestName=null, currentDriverId=null;
let drivers=[], guests=[], hotels=[], pickupRequests=[];

function loadData(){
 drivers=JSON.parse(localStorage.getItem('drivers')||'[]');
 guests=JSON.parse(localStorage.getItem('guests')||'[]');
 hotels=JSON.parse(localStorage.getItem('hotels')||'[]');
 pickupRequests=JSON.parse(localStorage.getItem('pickupRequests')||'[]');
 currentDriverId=localStorage.getItem('currentDriverId');
}
function saveData(){
 localStorage.setItem('drivers',JSON.stringify(drivers));
 localStorage.setItem('guests',JSON.stringify(guests));
 localStorage.setItem('hotels',JSON.stringify(hotels));
 localStorage.setItem('pickupRequests',JSON.stringify(pickupRequests));
 if(currentDriverId)localStorage.setItem('currentDriverId',currentDriverId);
}

function loginAs(r){
 role=r;
 document.getElementById('login-screen').style.display='none';
 if(r==='guest'){document.getElementById('guest-login').style.display='block';}
 else{
   document.getElementById('main-app').style.display='block';
   updateContent();
   if(r==='driver') alert('–í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –≤–æ–¥–∏—Ç–µ–ª—å');
   if(r==='admin') alert('–í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä');
 }
}

function enterGuest(){
 const name=document.getElementById('guestNameInput').value.trim();
 if(!name){alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è');return;}
 currentGuestName=name;
 document.getElementById('guest-login').style.display='none';
 document.getElementById('main-app').style.display='block';
 document.getElementById('tabs').style.display='none'; // –≥–æ—Å—Ç–∏ –Ω–µ –≤–∏–¥—è—Ç –≤–∫–ª–∞–¥–∫–∏
 showGuestOrders();
}

function showGuestOrders(){
 const list=document.getElementById('orders-list');
 const guestOrders=pickupRequests.filter(r=>{
   const g=guests.find(x=>x.id===r.guestId);
   return g && g.fullName.toLowerCase().includes(currentGuestName.toLowerCase());
 });
 if(guestOrders.length===0){
   list.innerHTML='<div class="empty">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –≤–∞—à–µ –∏–º—è</div>';
   return;
 }
 list.innerHTML=guestOrders.map(o=>{
   const g=guests.find(x=>x.id===o.guestId);
   const h=o.hotelId?hotels.find(x=>x.id===o.hotelId):null;
   return `<div class="card"><h3>${g?.fullName}</h3>
   ${h?`<p>üè® ${h.name}</p>`:''}
   <p>üìÖ ${new Date(o.pickupDateEpochMs).toLocaleString('ru-RU')}</p>
   ${o.comment?`<p>üí¨ ${o.comment}</p>`:''}</div>`;
 }).join('');
}

function showTab(t){
 document.querySelectorAll('.content').forEach(e=>e.classList.remove('active'));
 document.getElementById(t).classList.add('active');
 document.querySelectorAll('.tab').forEach(e=>e.classList.remove('active'));
 event.target.classList.add('active');
 updateContent();
}

function updateContent(){updateQueue();updateDrivers();updateOrders();}
function updateQueue(){
 const el=document.getElementById('queue-list');
 if(role!=='admin'){el.innerHTML='<div class="empty">–û—á–µ—Ä–µ–¥—å –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É</div>';return;}
 if(pickupRequests.length===0){el.innerHTML='<div class="empty">–û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞</div>';return;}
 el.innerHTML=pickupRequests.map(r=>{
  const g=guests.find(x=>x.id===r.guestId);
  return `<div class="card"><h4>${g?.fullName||'–ì–æ—Å—Ç—å'}</h4><p>${new Date(r.pickupDateEpochMs).toLocaleString('ru-RU')}</p>${r.comment?`<p>üí¨ ${r.comment}</p>`:''}</div>`;
 }).join('');
}
function updateDrivers(){
 const el=document.getElementById('drivers-list');
 if(drivers.length===0){el.innerHTML='<div class="empty">–ù–µ—Ç –≤–æ–¥–∏—Ç–µ–ª–µ–π</div>';return;}
 el.innerHTML=drivers.map(d=>`<div class="card"><h4>${d.name}</h4><p>${d.phone}</p><p>${d.carNumber}</p></div>`).join('');
}
function updateOrders(){
 const el=document.getElementById('orders-list');
 if(role==='driver'){
   const myOrders=pickupRequests.filter(r=>r.assignedDriverId===currentDriverId);
   if(myOrders.length===0){el.innerHTML='<div class="empty">–£ –≤–∞—Å –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>';return;}
   el.innerHTML=myOrders.map(o=>{
     const g=guests.find(x=>x.id===o.guestId);
     return `<div class="card"><h3>${g?.fullName}</h3><p>${new Date(o.pickupDateEpochMs).toLocaleString('ru-RU')}</p>${o.comment?`<p>üí¨ ${o.comment}</p>`:''}</div>`;
   }).join('');
 }else if(role==='admin'){updateQueue();}
}

function addGuest(){
 if(role!=='admin'){alert('–î–æ–±–∞–≤–ª—è—Ç—å –≥–æ—Å—Ç–µ–π –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä');return;}
 const name=document.getElementById('guestName').value.trim();
 const control=document.getElementById('controlPerson').value.trim();
 const hotel=document.getElementById('hotelName').value.trim();
 const date=document.getElementById('pickupDate').value;
 const comment=document.getElementById('pickupComment').value.trim();
 if(!name||!date){alert('–í–≤–µ–¥–∏—Ç–µ –§–ò–û –∏ –¥–∞—Ç—É');return;}
 const guest={id:Date.now()+'g',fullName:name,controlPerson:control};
 guests.push(guest);
 let hotelObj=null;
 if(hotel){hotelObj={id:Date.now()+'h',name:hotel};hotels.push(hotelObj);}
 pickupRequests.push({id:Date.now()+'r',guestId:guest.id,hotelId:hotelObj?.id,assignedDriverId:null,pickupDateEpochMs:new Date(date).getTime(),comment});
 saveData();
 alert('–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω!');
 updateContent();
}
window.onload=()=>{loadData();}
</script>
</body>
</html>
