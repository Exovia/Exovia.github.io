<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–°–∏—Å—Ç–µ–º–∞ –≤—Å—Ç—Ä–µ—á –≥–æ—Å—Ç–µ–π</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f2f2f7;
    }
    header {
      background: #007aff;
      color: white;
      padding: 12px;
      text-align: center;
      font-weight: bold;
      position: relative;
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .form-group { margin-bottom: 12px; }
    .form-label { display: block; font-weight: bold; margin-bottom: 6px; }
    .form-input, textarea, select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .btn {
      background: #007aff;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      margin-right: 6px;
    }
    .btn:hover { background: #005fc4; }
    .card {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 12px;
      margin: 10px 0;
      background: #fafafa;
    }
    .nav {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    .nav button {
      padding: 8px 14px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    .nav .active {
      background: #007aff;
      color: white;
    }
    #logout-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #ff3b30;
    }
  </style>
</head>
<body>
  <header>
    üöò –°–∏—Å—Ç–µ–º–∞ –≤—Å—Ç—Ä–µ—á –≥–æ—Å—Ç–µ–π
    <button id="logout-btn" class="btn" style="display:none;">–í—ã–π—Ç–∏</button>
  </header>

  <!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
  <div class="container" id="auth-container">
    <h2>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
    <div class="form-group">
      <label class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
      <input id="login-username" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
    </div>
    <div class="form-group">
      <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
      <input type="password" id="login-password" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
    </div>
    <div class="form-group">
      <label class="form-label">–†–æ–ª—å</label>
      <select id="login-role" class="form-input">
        <option value="driver">–í–æ–¥–∏—Ç–µ–ª—å</option>
        <option value="guest">–ì–æ—Å—Ç—å</option>
      </select>
    </div>
    <button class="btn" onclick="login()">–í–æ–π—Ç–∏</button>
    <button class="btn" style="background:#28a745;" onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
    <p style="margin-top:8px; color:#888;">–ê–¥–º–∏–Ω: admin / 1234</p>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
  <div class="container" id="app-container" style="display:none;">
    <div class="nav" id="nav-tabs"></div>
    <div id="tab-add-content" style="display:none;">
      <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –≥–æ—Å—Ç—è</h3>
      <div class="form-group">
        <label class="form-label">–§–ò–û –≥–æ—Å—Ç—è</label>
        <input id="guest-name" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –§–ò–û">
      </div>
      <div class="form-group">
        <label class="form-label">–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–µ–µ –ª–∏—Ü–æ</label>
        <input id="control-person" class="form-input" placeholder="–ö—Ç–æ –¥–æ–ª–∂–µ–Ω –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å">
      </div>
      <div class="form-group">
        <label class="form-label">–û—Ç–µ–ª—å</label>
        <input id="hotel-name" class="form-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–µ–ª—è">
      </div>
      <div class="form-group">
        <label class="form-label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –≤—Å—Ç—Ä–µ—á–∏</label>
        <input type="datetime-local" id="pickup-date" class="form-input">
      </div>
      <div class="form-group">
        <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
        <textarea id="pickup-comment" rows="2" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Ä–µ–π—Å –∑–∞–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è..."></textarea>
      </div>
      <button class="btn" onclick="addGuest()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>

    <div id="tab-queue-content" style="display:none;">
      <h3>–û—á–µ—Ä–µ–¥—å –∑–∞–∫–∞–∑–æ–≤</h3>
      <div id="queue-list"></div>
    </div>

    <div id="tab-orders-content" style="display:none;">
      <h3>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h3>
      <div id="order-list"></div>
    </div>
  </div>

  <script>
    const ADMIN = { username: 'admin', password: '1234', role: 'admin' };
    let currentUser = null;

    // --- –•—Ä–∞–Ω–∏–ª–∏—â–∞ ---
    const saveUsers = users => localStorage.setItem('users', JSON.stringify(users));
    const loadUsers = () => JSON.parse(localStorage.getItem('users') || '[]');
    const loadRequests = () => JSON.parse(localStorage.getItem('requests') || '[]');
    const saveRequests = reqs => localStorage.setItem('requests', JSON.stringify(reqs));

    // --- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ---
    function register() {
      const username = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value.trim();
      const role = document.getElementById('login-role').value;
      if (!username || !password) return alert('–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å');
      const users = loadUsers();
      if (users.find(u => u.username === username)) return alert('–¢–∞–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –µ—Å—Ç—å');
      users.push({ username, password, role });
      saveUsers(users);
      alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ.');
    }

    // --- –í—Ö–æ–¥ ---
    function login() {
      const username = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value.trim();
      if (username === ADMIN.username && password === ADMIN.password) {
        currentUser = ADMIN;
      } else {
        const users = loadUsers();
        const user = users.find(u => u.username === username && u.password === password);
        if (!user) return alert('–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
        currentUser = user;
      }
      localStorage.setItem('currentUser', JSON.stringify(currentUser));
      showApp();
    }

    // --- –í—ã—Ö–æ–¥ ---
    function logout() {
      localStorage.removeItem('currentUser');
      currentUser = null;
      document.getElementById('auth-container').style.display = 'block';
      document.getElementById('app-container').style.display = 'none';
      document.getElementById('logout-btn').style.display = 'none';
    }

    // --- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ –ø–æ —Ä–æ–ª—è–º ---
    function showApp() {
      document.getElementById('auth-container').style.display = 'none';
      document.getElementById('app-container').style.display = 'block';
      document.getElementById('logout-btn').style.display = 'block';

      const nav = document.getElementById('nav-tabs');
      nav.innerHTML = '';
      const addTab = roleButton('add', '–î–æ–±–∞–≤–∏—Ç—å –≥–æ—Å—Ç—è');
      const queueTab = roleButton('queue', '–û—á–µ—Ä–µ–¥—å');
      const orderTab = roleButton('orders', '–ú–æ–∏ –∑–∞–∫–∞–∑—ã');

      if (currentUser.role === 'admin') nav.append(addTab, queueTab, orderTab);
      else if (currentUser.role === 'driver') nav.append(queueTab, orderTab);
      else if (currentUser.role === 'guest') nav.append(orderTab);

      showTab(currentUser.role === 'admin' ? 'queue' : 'orders');
      updateQueue();
      updateOrders();
    }

    function roleButton(id, name) {
      const btn = document.createElement('button');
      btn.id = `tab-${id}`;
      btn.textContent = name;
      btn.onclick = () => showTab(id);
      return btn;
    }

    // --- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ ---
    function showTab(tab) {
      document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
      const tabBtn = document.getElementById(`tab-${tab}`);
      if (tabBtn) tabBtn.classList.add('active');
      document.querySelectorAll('#app-container > div[id$="-content"]').forEach(d => d.style.display = 'none');
      const content = document.getElementById(`tab-${tab}-content`);
      if (content) content.style.display = 'block';
    }

    // --- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Å—Ç—è ---
    function addGuest() {
      if (currentUser.role !== 'admin') return alert('–î–æ–±–∞–≤–ª—è—Ç—å –≥–æ—Å—Ç–µ–π –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.');

      const guestName = document.getElementById('guest-name').value.trim();
      const controlPerson = document.getElementById('control-person').value.trim();
      const hotelName = document.getElementById('hotel-name').value.trim();
      const pickupDate = document.getElementById('pickup-date').value;
      const pickupComment = document.getElementById('pickup-comment').value.trim();
      if (!guestName || !controlPerson || !hotelName || !pickupDate)
        return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');

      const reqs = loadRequests();
      reqs.push({
        id: Date.now(),
        guestName,
        controlPerson,
        hotelName,
        pickupDate,
        comment: pickupComment,
        assignedDriver: null
      });
      saveRequests(reqs);
      document.querySelectorAll('#tab-add-content input, #tab-add-content textarea').forEach(i => i.value = '');
      updateQueue();
      alert('–ì–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω!');
    }

    // --- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–∏ ---
    function updateQueue() {
      const list = document.getElementById('queue-list');
      const reqs = loadRequests();
      list.innerHTML = '';
      const users = loadUsers();
      const isAdmin = currentUser.role === 'admin';

      reqs.forEach(r => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <p><b>–ì–æ—Å—Ç—å:</b> ${r.guestName}</p>
          <p>–ö–æ–Ω—Ç—Ä–æ–ª—å: ${r.controlPerson}</p>
          <p>–û—Ç–µ–ª—å: ${r.hotelName}</p>
          <p>üìÖ ${r.pickupDate}</p>
          ${r.comment ? `<p>üí¨ ${r.comment}</p>` : ''}
          <p>üöó –í–æ–¥–∏—Ç–µ–ª—å: ${r.assignedDriver ?? '–Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω'}</p>
        `;
        if (isAdmin) {
          const select = document.createElement('select');
          select.innerHTML = `<option value="">–ù–∞–∑–Ω–∞—á–∏—Ç—å –≤–æ–¥–∏—Ç–µ–ª—è</option>` +
            users.filter(u => u.role === 'driver')
                 .map(u => `<option value="${u.username}">${u.username}</option>`).join('');
          select.value = r.assignedDriver || '';
          select.onchange = () => {
            r.assignedDriver = select.value || null;
            saveRequests(reqs);
            updateQueue();
            updateOrders();
          };
          card.appendChild(select);
        }
        list.appendChild(card);
      });
    }

    // --- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ (–≤–æ–¥–∏—Ç–µ–ª—å / –≥–æ—Å—Ç—å) ---
    function updateOrders() {
      const list = document.getElementById('order-list');
      const reqs = loadRequests();
      list.innerHTML = '';
      let myOrders = [];

      if (currentUser.role === 'driver') {
        myOrders = reqs.filter(r => r.assignedDriver === currentUser.username);
      } else if (currentUser.role === 'guest') {
        myOrders = reqs.filter(r => r.guestName.toLowerCase() === currentUser.username.toLowerCase());
      } else if (currentUser.role === 'admin') {
        myOrders = reqs;
      }

      myOrders.forEach(r => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <p><b>–ì–æ—Å—Ç—å:</b> ${r.guestName}</p>
          <p>–û—Ç–µ–ª—å: ${r.hotelName}</p>
          <p>üìÖ ${r.pickupDate}</p>
          ${r.comment ? `<p>üí¨ ${r.comment}</p>` : ''}
          ${r.assignedDriver ? `<p>üöó –í–æ–¥–∏—Ç–µ–ª—å: ${r.assignedDriver}</p>` : ''}
        `;
        list.appendChild(card);
      });
      if (myOrders.length === 0) list.innerHTML = '<p>–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>';
    }

    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ---
    const savedUser = localStorage.getItem('currentUser');
    if (savedUser) {
      currentUser = JSON.parse(savedUser);
      showApp();
    }
    document.getElementById('logout-btn').onclick = logout;
  </script>
</body>
</html>
